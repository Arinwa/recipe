<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recipe App</title>
</head>

<body>
  <h1>Recipe App</h1>
  <div>
    <h2>All Recipes</h2>
    <table id="recipesTable" border="1">
      <thead>
        <tr>
          <th>Title</th>
          <th>Ingredients</th>
          <th>Instructions</th>
          <th>Cooking Time</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <!-- Recipes will be populated here -->
      </tbody>
    </table>
  </div>
  <div>
    <h2>Add a New Recipe</h2>
    <form id="addRecipeForm">
      <input type="text" id="title" placeholder="Title" required><br>
      <textarea id="ingredients" placeholder="Ingredients (comma separated)" required></textarea><br>
      <textarea id="instructions" placeholder="Instructions" required></textarea><br>
      <input type="number" id="cookingTime" placeholder="Cooking Time (in minutes)" required><br>
      <button type="submit">Add Recipe</button>
    </form>
  </div>

  <script>
    async function fetchRecipes() {
      const response = await fetch('/api/recipes');
      const data = await response.json();
      const tableBody = document.querySelector('#recipesTable tbody');
      tableBody.innerHTML = '';
      data.forEach(recipe => {
        const row = document.createElement('tr');
        row.innerHTML = `
                    <td>${recipe.title}</td>
                    <td>${recipe.ingredients.join(', ')}</td>
                    <td>${recipe.instructions}</td>
                    <td>${recipe.cookingTime}</td>
                    <td>
                        <button onclick="editRecipe('${recipe._id}')">Update</button>
                        <button onclick="deleteRecipe('${recipe._id}')">Delete</button>
                    </td>
                `;
        tableBody.appendChild(row);
      });
    }

    async function addRecipe(event) {
      event.preventDefault();
      const title = document.getElementById('title').value;
      const ingredients = document.getElementById('ingredients').value.split(',').map(item => item.trim());
      const instructions = document.getElementById('instructions').value;
      const cookingTime = document.getElementById('cookingTime').value;

      const response = await fetch('/api/recipes', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ title, ingredients, instructions, cookingTime })
      });

      if (response.status === 201) {
        fetchRecipes();
      } else {
        const errorData = await response.json();
        alert(`Error: ${errorData.message}`);
      }
    }

    async function deleteRecipe(id) {
      if (confirm('Are you sure you want to delete this recipe?')) {
        const response = await fetch(`/api/recipes/${id}`, {
          method: 'DELETE'
        });

        if (response.status === 200) {
          fetchRecipes();
        } else {
          const errorData = await response.json();
          alert(`Error: ${errorData.message}`);
        }
      }
    }

    function editRecipe(id) {
      // Implement edit functionality here (e.g., show a form with the current recipe details)
    }

    document.getElementById('addRecipeForm').addEventListener('submit', addRecipe);

    fetchRecipes();
  </script>
</body>

</html>